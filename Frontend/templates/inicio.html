<!DOCTYPE html>
<html>
<head>
  <title>Catálogo de Pasteles</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="#" data-tipo="todos">Todos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tipo="horneado">Horneado</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tipo="frío">Frio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tipo="yogurt">Yogurt</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tipo="queso">Queso</a>
        </li>
      </ul>
      <div id="admin-menu" style="display: none;">
        <ul class="navbar-nav ml-auto">
          <!-- Los elementos del menú y submenús se agregarán aquí -->
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
    <h1>Catálogo de Pasteles</h1>
    <div class="row" id="pastelesCatalog">
      <!-- Aquí se mostrarán los pasteles dinámicamente -->
    </div>
  </div>
  <!-- Ventana emergente -->
  <div class="modal" id="comprarModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirmar compra</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="comprarForm">
            <div class="form-group">
              <label for="nombreCliente">Nombre del Cliente</label>
              <input type="text" class="form-control" id="nombreCliente" placeholder="Nombre del cliente" readonly>
            </div>
            <div class="form-group">
              <label for="nombrePastel">Nombre del Pastel</label>
              <input type="text" class="form-control" id="nombrePastel" placeholder="Nombre del pastel" readonly>
            </div>
            <div class="form-group">
              <label for="tipoPastel">Tipo de Pastel</label>
              <input type="text" class="form-control" id="tipoPastel" placeholder="Tipo de pastel" readonly>
            </div>
            <div class="form-group">
              <label for="saborPastel">Sabor del Pastel</label>
              <input type="text" class="form-control" id="saborPastel" placeholder="Sabor del pastel" readonly>
            </div>
            <div class="form-group">
              <label for="precioPastel">Precio del Pastel</label>
              <input type="text" class="form-control" id="precioPastel" placeholder="Precio del pastel" readonly>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="agregarAlCarrito">Agregar al carrito</button>
        </div>
      </div>
    </div>
  </div>
  

  <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.0/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <script>
    // Recupera los pasteles del almacenamiento local
    const pasteles = JSON.parse(localStorage.getItem("Pasteles"));

    // Obtén la referencia al elemento donde se mostrarán los pasteles
    const pastelesCatalog = document.getElementById("pastelesCatalog");

    // Función para cargar los pasteles en el catálogo
    function cargarPasteles(pastelesResponse) {
      pastelesCatalog.innerHTML = ''; 

      const pasteles = pastelesResponse.Pasteles;

      if (pasteles && Array.isArray(pasteles)) {
        pasteles.forEach(pastel => {
          // Crea las tarjetas de los pasteles
          const card = document.createElement("div");
          card.classList.add("col-md-4");

          card.innerHTML = `
            <div class="card mb-4 shadow-sm">
              <img src="pastel.jpg" class="card-img-top" alt="Imagen del pastel">
              <div class="card-body">
                <h5 class="card-title">${pastel.Nombre}</h5>
                <p class="card-text">
                  <strong>Tipo:</strong> ${pastel.Tipo}<br>
                  <strong>Sabor:</strong> ${pastel.Sabor}<br>
                  <strong>Relleno:</strong> ${pastel.Relleno}<br>
                  <strong>Precio:</strong> Q${pastel.Precio}<br>
                </p>
                <button class="btn btn-primary">Comprar</button>
              </div>
            </div>
          `;
          pastelesCatalog.appendChild(card);
        });
      } else {
        // Maneja el caso en el que no haya pasteles en la respuesta
        const noPastelesMessage = document.createElement("p");
        noPastelesMessage.textContent = "No hay pasteles disponibles.";
        pastelesCatalog.appendChild(noPastelesMessage);
      }
    }

    // Manejar el clic en los enlaces
    $("nav .nav-link").click(function (e) {
      e.preventDefault();

      const tipo = $(this).data("tipo");

      // Realizar una solicitud AJAX a la API basada en el tipo de pastel
      $.get(`http://localhost:5000/api/catalogo/${tipo}`, function (data) {
        cargarPasteles(data);
      });
    });

    // Por defecto, carga todos los pasteles al cargar la página
    cargarPasteles({ Pasteles: pasteles });


    // Recupera los menús y submenús del almacenamiento local
    const menus = JSON.parse(localStorage.getItem("Menus"));
    const submenus = JSON.parse(localStorage.getItem("Submenus"));
    
    localStorage.setItem("Menus", JSON.stringify(menus));
    localStorage.setItem("Submenus", JSON.stringify(submenus));

    // console.log(submenus)
    // Recupera el nombre de usuario del almacenamiento local
    const usuario = localStorage.getItem("Usuario");
    // console.log(usuario)
    // Verificar si el usuario es administrador y mostrar menús y submenús si es el caso
    if (usuario === "Administrador" && menus && menus.length && submenus && submenus.length) {
      const adminMenu = document.getElementById("admin-menu");
      adminMenu.style.display = "block";

      // Agregar los elementos del menú y submenús aquí
      const adminMenuList = adminMenu.querySelector("ul.navbar-nav");
      // menus.forEach(menu => {
      //   const menuElement = document.createElement("li");
      //   menuElement.classList.add("nav-item");
      //   const menuLink = document.createElement("a");
      //   menuLink.classList.add("nav-link");
      //   menuLink.textContent = menu;
      //   menuElement.appendChild(menuLink);
      //   adminMenuList.appendChild(menuElement);
      // });
      submenus.forEach(submenu => {
        const submenuElement = document.createElement("li");
        submenuElement.classList.add("nav-item");
        const submenuLink = document.createElement("a");
        submenuLink.classList.add("nav-link");
        submenuLink.textContent = submenu;
        submenuElement.appendChild(submenuLink);
        adminMenuList.appendChild(submenuElement);
      });
    }

  
    // Código para mostrar la ventana emergente cuando se hace clic en "Comprar"
    const comprarButton = document.querySelectorAll('.btn.btn-primary');
    comprarButton.forEach((button) => {
      button.addEventListener('click', function () {
        $('#comprarModal').modal('show');
      });
    });
  
    // Código para crear un pedido al hacer clic en "Agregar al carrito"
    const agregarAlCarritoButton = document.getElementById('agregarAlCarrito');
    agregarAlCarritoButton.addEventListener('click', function () {
      const cliente = usuario; 
      const productos = ["Pastel de Chocolate"];
  
      // Realiza una solicitud AJAX para crear un pedido al contado
      $.ajax({
        type: 'POST',
        url: '/api/pedido',
        contentType: 'application/json',
        data: JSON.stringify({ cliente, productos }),
        success: function (response) {
          // Aquí puedes manejar la respuesta de la API, por ejemplo, mostrar un mensaje de éxito
          alert('Pedido creado con éxito: ' + response.factura);
          $('#comprarModal').modal('hide');
        },
        error: function (error) {
          // Maneja cualquier error que ocurra durante la solicitud
          alert('Error al crear el pedido: ' + error.responseJSON.message);
        }
      });
    });

    // const comprarButton = document.querySelectorAll('.btn.btn-primary');
  comprarButton.forEach((button, index) => {
  button.addEventListener('click', function () {
    const pastel = pasteles[index]; // Obtener la información del pastel según el índice del botón
    const nombreClienteInput = document.getElementById('nombreCliente');
    const nombrePastelInput = document.getElementById('nombrePastel');
    const tipoPastelInput = document.getElementById('tipoPastel');
    const saborPastelInput = document.getElementById('saborPastel');
    const precioPastelInput = document.getElementById('precioPastel');
    
    // Llenar los campos con la información del pastel
    nombreClienteInput.value = usuario; // Nombre del cliente
    nombrePastelInput.value = pastel.Nombre;
    tipoPastelInput.value = pastel.Tipo; // Tipo del pastel
    saborPastelInput.value = pastel.Sabor; // Sabor del pastel
    precioPastelInput.value = `Q${pastel.Precio}`; // Precio del pastel

    $('#comprarModal').modal('show');
  });
});
  </script>
</body>
</html>
